import{a as V}from"./chunk-S6LUAGNY.js";import{a as D}from"./chunk-OR4RGIIA.js";import"./chunk-XF56FPVL.js";import{c as F,d as I}from"./chunk-7R7WLGXG.js";import{D as h,K as m,L as i,M as r,N as f,O as x,P as g,Q as u,R as T,S as w,V as s,X as _,ka as M,m as d,ma as P,n as p,o as C,oa as k,p as y,ua as E,va as O,w as l,y as b,z as S}from"./chunk-Q353D5L7.js";import"./chunk-KAT7YFEL.js";function N(o,t){if(o&1&&(i(0,"div",20)(1,"div",21),s(2),r()()),o&2){let e=u(2);l(),w("width",e.progress+"%"),l(),_("",e.progress,"%")}}function j(o,t){if(o&1){let e=x();i(0,"div",14)(1,"div",15)(2,"p",16),s(3),r(),i(4,"button",17),g("click",function(){d(e);let a=u();return p(a.removeFile())}),s(5,"\u2715"),r()(),i(6,"button",18),g("click",function(){d(e);let a=u();return p(a.uploadFile())}),s(7),r(),h(8,N,3,3,"div",19),r()}if(o&2){let e=u();l(3),_("Archivo seleccionado: ",e.selectedFile.name),l(3),m("disabled",e.uploading),l(),_(" ",e.uploading?"Subiendo...":"Subir Archivo"," "),l(),m("ngIf",e.uploading)}}function z(o,t){o&1&&(i(0,"div",22),C(),i(1,"svg",23),f(2,"circle",24)(3,"path",25),r(),y(),i(4,"span"),s(5,"\xA1El archivo se carg\xF3 correctamente!"),r()())}function R(o,t){o&1&&(i(0,"div",26)(1,"div",27),f(2,"span",28),i(3,"span",29),s(4,"Cargando..."),r()()())}var U=class o{constructor(t,e,n){this.taskService=t;this.notificationService=e;this.router=n}selectedFile=null;uploading=!1;progress=0;uploadSuccess=!1;onFileSelected(t){let e=t.target;e.files?.length&&(this.selectedFile=e.files[0],this.uploadSuccess=!1,this.progress=0)}removeFile(){this.selectedFile=null,this.uploadSuccess=!1,this.progress=0}onDragOver(t){t.preventDefault(),t.stopPropagation()}onDrop(t){t.preventDefault(),t.stopPropagation();let e=t.dataTransfer?.files;e?.length&&(this.selectedFile=e[0],this.uploadSuccess=!1,this.progress=0)}uploadFile(){if(!this.selectedFile)return;this.uploading=!0,this.progress=0,this.uploadSuccess=!1;let t=new FormData;t.append("file",this.selectedFile),this.taskService.uploadExcel(t).subscribe({next:e=>{if(e.type===k.UploadProgress&&e.total)this.progress=Math.round(e.loaded/e.total*100);else if(e.type===k.Response){this.uploading=!1,this.uploadSuccess=!0;let n=e.body||"Tareas importadas correctamente";this.notificationService.showSuccess(n),setTimeout(()=>{this.router.navigate(["/tasks"])},2e3)}},error:e=>{this.uploading=!1;let n="Error al importar tareas";if(typeof e?.error=="string")try{let a=JSON.parse(e.error);n=a.detail||a.message||a.title||n}catch{n=e.error}else n=e?.error?.detail||e?.error?.message||e?.error||e?.message||n;this.notificationService.showError(n),console.error("Error al importar tareas:",e)}})}static \u0275fac=function(e){return new(e||o)(b(V),b(D),b(E))};static \u0275cmp=S({type:o,selectors:[["app-task-upload"]],decls:20,vars:3,consts:[["fileInput",""],[1,"card"],[1,"card-header"],[1,"card-title"],["routerLink","/tasks",1,"btn","btn-secondary"],[1,"card-body"],[1,"file-upload",3,"click","dragover","drop"],["type","file","accept",".xlsx,.xls",3,"change"],[1,"text-center"],[1,"mb-4"],[1,"text-sm","text-gray-500"],["class","mt-4 file-selected-box",4,"ngIf"],["class","custom-success-message mt-3",4,"ngIf"],["class","loading-overlay",4,"ngIf"],[1,"mt-4","file-selected-box"],[2,"display","flex","align-items","center","gap","0.5rem"],[1,"mb-2",2,"margin","0"],["aria-label","Eliminar archivo",1,"btn-x",3,"click"],[1,"btn","btn-primary",3,"click","disabled"],["class","progress-bar-container",4,"ngIf"],[1,"progress-bar-container"],[1,"progress-bar"],[1,"custom-success-message","mt-3"],["width","28","height","28","fill","none","viewBox","0 0 24 24"],["cx","12","cy","12","r","12","fill","#22c55e"],["d","M7 13l3 3 7-7","stroke","#fff","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"loading-overlay"],[1,"loading-content"],[1,"loader"],[1,"loading-text"]],template:function(e,n){if(e&1){let a=x();f(0,"app-navbar"),i(1,"div",1)(2,"div",2)(3,"h2",3),s(4,"Cargar Tareas desde Excel"),r(),i(5,"a",4),s(6," Volver a Tareas "),r()(),i(7,"div",5)(8,"div",6),g("click",function(){d(a);let c=T(10);return p(c.click())})("dragover",function(c){return d(a),p(n.onDragOver(c))})("drop",function(c){return d(a),p(n.onDrop(c))}),i(9,"input",7,0),g("change",function(c){return d(a),p(n.onFileSelected(c))}),r(),i(11,"div",8)(12,"p",9),s(13,"Arrastra y suelta un archivo Excel aqu\xED o haz clic para seleccionar"),r(),i(14,"p",10),s(15,"Formatos soportados: .xlsx, .xls"),r()()(),h(16,j,9,4,"div",11)(17,z,6,0,"div",12)(18,R,5,0,"div",13),r()(),f(19,"app-footer")}e&2&&(l(16),m("ngIf",n.selectedFile),l(),m("ngIf",n.uploadSuccess),l(),m("ngIf",n.uploading))},dependencies:[P,M,O,F,I],styles:[".card[_ngcontent-%COMP%]{background:#fff;border-radius:1.5rem;box-shadow:0 4px 16px #1e293b14;max-width:500px;margin:2.5rem auto;padding:2rem 1.5rem}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.card-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#1e293b}.btn[_ngcontent-%COMP%]{background:#4f46e5;color:#fff;border:none;border-radius:.5rem;padding:.6rem 1.2rem;font-weight:600;font-size:1rem;cursor:pointer;transition:background .2s;text-decoration:none}.btn-secondary[_ngcontent-%COMP%]{background:#f3f4f6;color:#1e293b}.btn-secondary[_ngcontent-%COMP%]:hover{background:#e5e7eb}.btn-primary[_ngcontent-%COMP%]:hover{background:#3730a3}.btn-x[_ngcontent-%COMP%]{background:transparent;border:none;color:#ef4444;font-size:1.2rem;cursor:pointer;margin-left:.5rem;transition:color .2s}.btn-x[_ngcontent-%COMP%]:hover{color:#b91c1c}.file-upload[_ngcontent-%COMP%]{border:2px dashed #cbd5e1;border-radius:1rem;padding:2rem;text-align:center;background:#f7fafc;cursor:pointer;transition:border .2s,background .2s;margin-bottom:1.5rem}.file-upload[_ngcontent-%COMP%]:hover{border-color:#4f46e5;background:#eef2ff}.file-upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{display:none}.file-selected-box[_ngcontent-%COMP%]{background:#f3f4f6;border-radius:.5rem;padding:1rem;margin-bottom:1rem}.progress-bar-container[_ngcontent-%COMP%]{background:#e5e7eb;border-radius:.5rem;margin-top:.5rem;height:1.2rem;width:100%;overflow:hidden}.progress-bar[_ngcontent-%COMP%]{background:#4f46e5;color:#fff;height:100%;border-radius:.5rem;text-align:center;font-size:.95rem;font-weight:600;transition:width .3s}.custom-success-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:#22c55e;font-weight:600;font-size:1.1rem;margin-top:1rem}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#ffffffb3;display:flex;align-items:center;justify-content:center;z-index:10}.loading-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.7rem}.loader[_ngcontent-%COMP%]{width:1.5rem;height:1.5rem;border:3px solid #c7d2fe;border-top:3px solid #4f46e5;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@media (max-width: 600px){.card[_ngcontent-%COMP%]{padding:1rem .3rem}.file-upload[_ngcontent-%COMP%]{padding:1rem}}"]})};export{U as TaskUploadComponent};
